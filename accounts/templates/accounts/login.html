{% extends 'base/base.html' %}
{% load static %}

{% block title %}Login | PesaFlow{% endblock %}

{% block extra_css %}
<style>
    .login-hero {
        background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
        min-height: 100vh;
        display: flex;
        align-items: center;
        padding: 80px 0 40px 0;
    }
    
    .login-container {
        background: white;
        border-radius: 20px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15);
        overflow: hidden;
        animation: slideIn 0.6s ease-out;
    }
    
    @keyframes slideIn {
        from {
            opacity: 0;
            transform: translateX(30px);
        }
        to {
            opacity: 1;
            transform: translateX(0);
        }
    }
    
    .login-left {
        background: linear-gradient(135deg, rgba(67, 97, 238, 0.95), rgba(58, 12, 163, 0.95));
        color: white;
        padding: 60px 40px;
        display: flex;
        flex-direction: column;
        justify-content: center;
        position: relative;
        overflow: hidden;
    }
    
    .login-left::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1000 1000"><path fill="%234cc9f0" fill-opacity="0.1" d="M0,500 Q250,400 500,500 T1000,500 L1000,1000 L0,1000 Z"/></svg>');
        background-size: cover;
        opacity: 0.3;
    }
    
    .login-right {
        padding: 60px 40px;
    }
    
    .brand-showcase {
        position: relative;
        z-index: 1;
        margin-bottom: 40px;
    }
    
    .brand-logo-large {
        font-size: 3rem;
        font-weight: 800;
        margin-bottom: 20px;
        display: flex;
        align-items: center;
        gap: 15px;
    }
    
    .brand-logo-large i {
        background: rgba(255, 255, 255, 0.15);
        padding: 20px;
        border-radius: 20px;
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.2);
    }
    
    .brand-tagline {
        font-size: 1.1rem;
        opacity: 0.9;
        line-height: 1.6;
    }
    
    .stats-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 20px;
        margin-top: 40px;
    }
    
    .stat-item {
        text-align: center;
        padding: 15px;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 10px;
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.2);
    }
    
    .stat-number {
        font-size: 1.8rem;
        font-weight: 700;
        margin-bottom: 5px;
    }
    
    .stat-label {
        font-size: 0.9rem;
        opacity: 0.8;
    }
    
    /* Role Selection */
    .role-selector {
        margin-bottom: 30px;
    }
    
    .role-selector-title {
        text-align: center;
        margin-bottom: 25px;
        position: relative;
    }
    
    .role-selector-title h2 {
        font-weight: 700;
        color: var(--dark-color);
        display: inline-block;
        padding: 0 20px;
        background: white;
        position: relative;
        z-index: 1;
    }
    
    .role-selector-title::after {
        content: '';
        position: absolute;
        top: 50%;
        left: 0;
        right: 0;
        height: 2px;
        background: #e9ecef;
        transform: translateY(-50%);
    }
    
    .role-tabs {
        display: flex;
        justify-content: center;
        gap: 10px;
        margin-bottom: 30px;
    }
    
    .role-tab {
        padding: 12px 25px;
        border: 2px solid #e9ecef;
        border-radius: 10px;
        background: white;
        color: var(--dark-color);
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    .role-tab:hover {
        border-color: var(--primary-color);
        transform: translateY(-2px);
    }
    
    .role-tab.active {
        background: var(--primary-color);
        border-color: var(--primary-color);
        color: white;
        box-shadow: 0 5px 15px rgba(67, 97, 238, 0.2);
    }
    
    .role-tab i {
        font-size: 1.2rem;
    }
    
    /* Login Form */
    .login-form-container {
        margin-bottom: 30px;
    }
    
    .login-form {
        animation: fadeIn 0.5s ease;
    }
    
    .form-header {
        text-align: center;
        margin-bottom: 30px;
    }
    
    .form-header h3 {
        font-weight: 700;
        color: var(--dark-color);
        margin-bottom: 10px;
    }
    
    .form-header p {
        color: #6c757d;
        margin-bottom: 0;
    }
    
    .form-group-enhanced {
        margin-bottom: 25px;
    }
    
    .form-group-enhanced label {
        font-weight: 600;
        color: var(--dark-color);
        margin-bottom: 8px;
        display: flex;
        align-items: center;
        gap: 8px;
    }
    
    .input-with-icon {
        position: relative;
    }
    
    .input-with-icon i {
        position: absolute;
        left: 15px;
        top: 50%;
        transform: translateY(-50%);
        color: #6c757d;
        z-index: 2;
    }
    
    .input-with-icon input {
        padding-left: 45px;
        border-radius: 10px;
        border: 2px solid #e9ecef;
        transition: all 0.3s ease;
    }
    
    .input-with-icon input:focus {
        border-color: var(--primary-color);
        box-shadow: 0 0 0 0.25rem rgba(67, 97, 238, 0.25);
    }
    
    .password-toggle {
        position: absolute;
        right: 15px;
        top: 50%;
        transform: translateY(-50%);
        background: none;
        border: none;
        color: #6c757d;
        cursor: pointer;
        z-index: 2;
    }
    
    .form-options {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 25px;
    }
    
    .remember-me .form-check-input:checked {
        background-color: var(--primary-color);
        border-color: var(--primary-color);
    }
    
    .forgot-password {
        color: var(--primary-color);
        text-decoration: none;
        font-weight: 500;
    }
    
    .forgot-password:hover {
        text-decoration: underline;
    }
    
    .login-btn {
        width: 100%;
        padding: 14px;
        font-size: 1.1rem;
        font-weight: 600;
        border-radius: 10px;
        border: none;
        background: var(--primary-color);
        color: white;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
    }
    
    .login-btn:hover {
        background: var(--secondary-color);
        transform: translateY(-2px);
        box-shadow: 0 10px 20px rgba(67, 97, 238, 0.2);
    }
    
    /* Role-specific login hints */
    .role-hint {
        display: none;
        padding: 15px;
        background: #f8f9fa;
        border-radius: 10px;
        margin-bottom: 20px;
        border-left: 4px solid var(--primary-color);
        animation: fadeIn 0.5s ease;
    }
    
    .role-hint.active {
        display: block;
    }
    
    .role-hint p {
        margin-bottom: 0;
        color: #495057;
        font-size: 0.9rem;
    }
    
    .role-hint i {
        color: var(--primary-color);
        margin-right: 10px;
    }
    
    /* Dashboard preview */
    .dashboard-preview {
        display: none;
        margin-bottom: 20px;
        padding: 15px;
        background: linear-gradient(135deg, rgba(67, 97, 238, 0.1), rgba(58, 12, 163, 0.1));
        border-radius: 10px;
        border-left: 4px solid var(--primary-color);
        animation: fadeIn 0.5s ease;
    }
    
    .dashboard-preview.active {
        display: block;
    }
    
    .dashboard-preview h6 {
        font-weight: 600;
        color: var(--primary-color);
        margin-bottom: 5px;
    }
    
    .dashboard-preview ul {
        margin: 0;
        padding-left: 20px;
    }
    
    .dashboard-preview li {
        font-size: 0.85rem;
        color: #495057;
        margin-bottom: 3px;
    }
    
    /* Social Login */
    .social-login {
        margin-top: 30px;
    }
    
    .social-divider {
        display: flex;
        align-items: center;
        margin: 20px 0;
        color: #6c757d;
    }
    
    .social-divider::before,
    .social-divider::after {
        content: '';
        flex: 1;
        height: 1px;
        background: #e9ecef;
    }
    
    .social-divider span {
        padding: 0 15px;
        font-size: 0.9rem;
    }
    
    .social-buttons {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 10px;
    }
    
    .social-btn {
        padding: 12px;
        border: 1px solid #e9ecef;
        border-radius: 10px;
        background: white;
        color: var(--dark-color);
        font-weight: 500;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
    }
    
    .social-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        border-color: var(--primary-color);
    }
    
    .social-btn.google { color: #ea4335; }
    .social-btn.microsoft { color: #00a4ef; }
    .social-btn.sso { color: #7209b7; }
    
    /* Security Features */
    .security-features {
        margin-top: 30px;
        padding: 20px;
        background: #f8f9fa;
        border-radius: 10px;
        text-align: center;
    }
    
    .security-features h6 {
        margin-bottom: 15px;
        font-weight: 600;
    }
    
    .security-icons {
        display: flex;
        justify-content: center;
        gap: 20px;
        flex-wrap: wrap;
    }
    
    .security-icon {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 5px;
    }
    
    .security-icon i {
        color: var(--primary-color);
        font-size: 1.2rem;
    }
    
    .security-icon span {
        font-size: 0.8rem;
        color: #6c757d;
    }
    
    /* Registration Link */
    .register-link {
        text-align: center;
        margin-top: 30px;
        padding-top: 20px;
        border-top: 1px solid #e9ecef;
    }
    
    .register-link a {
        color: var(--primary-color);
        font-weight: 600;
        text-decoration: none;
    }
    
    .register-link a:hover {
        text-decoration: underline;
    }
    
    /* Demo Credentials Modal */
    .demo-credentials {
        margin-top: 20px;
        text-align: center;
    }
    
    .demo-btn {
        background: none;
        border: none;
        color: var(--primary-color);
        font-size: 0.9rem;
        cursor: pointer;
        text-decoration: underline;
    }
    
    .demo-btn:hover {
        color: var(--secondary-color);
    }
    
    /* Error Messages */
    .alert-role {
        display: none;
        animation: shake 0.5s ease;
    }
    
    @keyframes shake {
        0%, 100% { transform: translateX(0); }
        25% { transform: translateX(-10px); }
        75% { transform: translateX(10px); }
    }
    
    /* Redirect Notification */
    .redirect-notification {
        position: fixed;
        top: 20px;
        right: 20px;
        background: white;
        border-radius: 10px;
        padding: 15px 20px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.15);
        border-left: 4px solid var(--primary-color);
        z-index: 9999;
        display: none;
        animation: slideInRight 0.5s ease;
    }
    
    @keyframes slideInRight {
        from {
            opacity: 0;
            transform: translateX(100px);
        }
        to {
            opacity: 1;
            transform: translateX(0);
        }
    }
    
    /* Responsive */
    @media (max-width: 768px) {
        .login-left {
            padding: 40px 20px;
        }
        
        .login-right {
            padding: 40px 20px;
        }
        
        .brand-logo-large {
            font-size: 2rem;
        }
        
        .role-tabs {
            flex-direction: column;
        }
        
        .social-buttons {
            grid-template-columns: 1fr;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="login-hero">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-xl-10">
                <div class="login-container">
                    <div class="row g-0">
                        <!-- Left Sidebar -->
                        <div class="col-lg-6">
                            <div class="login-left">
                                <div class="brand-showcase">
                                    <div class="brand-logo-large">
                                        <i class="fas fa-money-bill-wave"></i>
                                        <span>PesaFlow</span>
                                    </div>
                                    <p class="brand-tagline">Secure payment management platform trusted by thousands of businesses across Africa. Streamline your transactions with enterprise-grade security and real-time analytics.</p>
                                </div>
                                
                                <div class="stats-grid">
                                    <div class="stat-item">
                                        <div class="stat-number">2,500+</div>
                                        <div class="stat-label">Businesses</div>
                                    </div>
                                    <div class="stat-item">
                                        <div class="stat-number">98.2%</div>
                                        <div class="stat-label">Uptime</div>
                                    </div>
                                    <div class="stat-item">
                                        <div class="stat-number">$45M+</div>
                                        <div class="stat-label">Processed</div>
                                    </div>
                                    <div class="stat-item">
                                        <div class="stat-number">24/7</div>
                                        <div class="stat-label">Support</div>
                                    </div>
                                </div>
                                
                                <div class="mt-4">
                                    <div class="security-features">
                                        <h6>Enterprise Security</h6>
                                        <div class="security-icons">
                                            <div class="security-icon">
                                                <i class="fas fa-shield-alt"></i>
                                                <span>256-bit SSL</span>
                                            </div>
                                            <div class="security-icon">
                                                <i class="fas fa-fingerprint"></i>
                                                <span>2FA</span>
                                            </div>
                                            <div class="security-icon">
                                                <i class="fas fa-user-lock"></i>
                                                <span>SOC2</span>
                                            </div>
                                            <div class="security-icon">
                                                <i class="fas fa-server"></i>
                                                <span>GDPR</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Right Content -->
                        <div class="col-lg-6">
                            <div class="login-right">
                                <!-- Role Selection -->
                                <div class="role-selector">
                                    <div class="role-selector-title">
                                        <h2>Sign In to PesaFlow</h2>
                                    </div>
                                    
                                    <div class="role-tabs">
                                        <div class="role-tab active" data-role="admin">
                                            <i class="fas fa-crown"></i>
                                            <span>Admin</span>
                                        </div>
                                        <div class="role-tab" data-role="business">
                                            <i class="fas fa-building"></i>
                                            <span>Business</span>
                                        </div>
                                        <div class="role-tab" data-role="client">
                                            <i class="fas fa-user-tie"></i>
                                            <span>Client</span>
                                        </div>
                                    </div>
                                    
                                    <!-- Role-specific hints -->
                                    <div class="role-hint active" id="adminHint">
                                        <p><i class="fas fa-info-circle"></i> Admin login: System administration and platform-wide management.</p>
                                    </div>
                                    <div class="role-hint" id="businessHint">
                                        <p><i class="fas fa-info-circle"></i> Business login: Manage your organization, payments, and analytics.</p>
                                    </div>
                                    <div class="role-hint" id="clientHint">
                                        <p><i class="fas fa-info-circle"></i> Client login: View invoices, make payments, and track transactions.</p>
                                    </div>
                                    
                                    <!-- Dashboard preview -->
                                    <div class="dashboard-preview active" id="adminPreview">
                                        <h6><i class="fas fa-tachometer-alt me-2"></i>Dashboard Features:</h6>
                                        <ul>
                                            <li>System-wide analytics and monitoring</li>
                                            <li>Organization management</li>
                                            <li>Platform configuration</li>
                                            <li>User activity logs</li>
                                        </ul>
                                    </div>
                                    <div class="dashboard-preview" id="businessPreview">
                                        <h6><i class="fas fa-chart-line me-2"></i>Dashboard Features:</h6>
                                        <ul>
                                            <li>Payment processing and tracking</li>
                                            <li>Customer management</li>
                                            <li>Revenue analytics</li>
                                            <li>Invoice generation</li>
                                        </ul>
                                    </div>
                                    <div class="dashboard-preview" id="clientPreview">
                                        <h6><i class="fas fa-user-circle me-2"></i>Dashboard Features:</h6>
                                        <ul>
                                            <li>Personal transaction history</li>
                                            <li>Invoice viewing and payment</li>
                                            <li>Payment method management</li>
                                            <li>Billing history</li>
                                        </ul>
                                    </div>
                                </div>
                                
                                <!-- Login Form -->
                                <div class="login-form-container">
                                    <div class="form-header">
                                        <h3 id="loginTitle">Admin Dashboard Login</h3>
                                        <p id="loginSubtitle">Access system administration and platform management</p>
                                    </div>
                                    
                                    {% if form.errors %}
                                    <div class="alert alert-danger alert-role">
                                        <i class="fas fa-exclamation-circle me-2"></i>
                                        Invalid credentials. Please try again.
                                    </div>
                                    {% endif %}
                                    
                                    <form method="post" class="login-form" id="loginForm">
                                        {% csrf_token %}
                                        <input type="hidden" name="role" id="selectedRole" value="admin">
                                        <input type="hidden" name="next" id="nextUrl" value="{% url 'admin_dashboard' %}">
                                        
                                        <div class="form-group-enhanced">
                                            <label for="username">
                                                <i class="fas fa-user-shield"></i>
                                                Admin Username
                                            </label>
                                            <div class="input-with-icon">
                                                <i class="fas fa-at"></i>
                                                <input type="text" class="form-control" id="username" name="username" 
                                                       placeholder="Enter admin username" required autofocus>
                                            </div>
                                        </div>
                                        
                                        <div class="form-group-enhanced">
                                            <label for="password">
                                                <i class="fas fa-lock"></i>
                                                Password
                                            </label>
                                            <div class="input-with-icon">
                                                <i class="fas fa-key"></i>
                                                <input type="password" class="form-control" id="password" name="password" 
                                                       placeholder="Enter your password" required>
                                                <button type="button" class="password-toggle" id="togglePassword">
                                                    <i class="fas fa-eye"></i>
                                                </button>
                                            </div>
                                        </div>
                                        
                                        <div class="form-options">
                                            <div class="remember-me">
                                                <div class="form-check">
                                                    <input class="form-check-input" type="checkbox" id="remember" name="remember">
                                                    <label class="form-check-label" for="remember">
                                                        Remember this device
                                                    </label>
                                                </div>
                                            </div>
                                            <div class="forgot-password">
                                                <a href="{% url 'password_reset' %}">Forgot password?</a>
                                            </div>
                                        </div>
                                        
                                        <button type="submit" class="login-btn" id="loginButton">
                                            <i class="fas fa-sign-in-alt"></i>
                                            Sign In to Admin Dashboard
                                        </button>
                                    </form>
                                    
                                    <!-- Demo Credentials -->
                                    <div class="demo-credentials">
                                        <button type="button" class="demo-btn" data-bs-toggle="modal" data-bs-target="#demoModal">
                                            <i class="fas fa-key me-1"></i>View Demo Credentials
                                        </button>
                                    </div>
                                </div>
                                
                                <!-- Social Login -->
                                <div class="social-login">
                                    <div class="social-divider">
                                        <span>Or continue with</span>
                                    </div>
                                    
                                    <div class="social-buttons">
                                        <button type="button" class="social-btn google" onclick="socialLogin('google')">
                                            <i class="fab fa-google"></i> Google
                                        </button>
                                        <button type="button" class="social-btn microsoft" onclick="socialLogin('microsoft')">
                                            <i class="fab fa-microsoft"></i> Microsoft
                                        </button>
                                        <button type="button" class="social-btn sso" onclick="ssoLogin()">
                                            <i class="fas fa-id-card"></i> Enterprise SSO
                                        </button>
                                    </div>
                                </div>
                                
                                <!-- Registration Link -->
                                <div class="register-link">
                                    <p>Don't have an account? <a href="{% url 'register' %}">Create one now</a></p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Redirect Notification -->
<div class="redirect-notification" id="redirectNotification">
    <div class="d-flex align-items-center">
        <i class="fas fa-spinner fa-spin me-3 text-primary"></i>
        <div>
            <h6 class="mb-1">Redirecting to <span id="redirectDashboard">Admin</span> Dashboard</h6>
            <small class="text-muted">Please wait while we authenticate your credentials...</small>
        </div>
    </div>
</div>

<!-- Demo Credentials Modal -->
<div class="modal fade" id="demoModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Demo Credentials</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="alert alert-info">
                    <i class="fas fa-info-circle me-2"></i>
                    Use these credentials to test different dashboards
                </div>
                
                <div class="mb-3">
                    <h6><i class="fas fa-crown text-warning me-2"></i>Admin Account</h6>
                    <p class="mb-1">Username: <code>admin@pesaflow.co.ke</code></p>
                    <p class="mb-1">Password: <code>Admin@2024</code></p>
                    <small class="text-muted">→ Redirects to: <strong>Admin Dashboard</strong></small>
                </div>
                
                <div class="mb-3">
                    <h6><i class="fas fa-building text-primary me-2"></i>Business Account</h6>
                    <p class="mb-1">Username: <code>business@example.com</code></p>
                    <p class="mb-1">Password: <code>Business@2024</code></p>
                    <small class="text-muted">→ Redirects to: <strong>Business Dashboard</strong></small>
                </div>
                
                <div class="mb-0">
                    <h6><i class="fas fa-user-tie text-success me-2"></i>Client Account</h6>
                    <p class="mb-1">Username: <code>client@example.com</code></p>
                    <p class="mb-0">Password: <code>Client@2024</code></p>
                    <small class="text-muted">→ Redirects to: <strong>Customer Dashboard</strong></small>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" onclick="autoFillCredentials()">
                    <i class="fas fa-magic me-2"></i>Auto-fill Current Role
                </button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        let selectedRole = 'admin';
        
        // Role tabs
        const roleTabs = document.querySelectorAll('.role-tab');
        const roleHints = document.querySelectorAll('.role-hint');
        const dashboardPreviews = document.querySelectorAll('.dashboard-preview');
        const loginTitle = document.getElementById('loginTitle');
        const loginSubtitle = document.getElementById('loginSubtitle');
        const selectedRoleInput = document.getElementById('selectedRole');
        const nextUrlInput = document.getElementById('nextUrl');
        const loginButton = document.getElementById('loginButton');
        const usernameInput = document.getElementById('username');
        
        // Dashboard URLs - Make sure these match your Django URL names
        const dashboardUrls = {
            'admin': "{% url 'admin_dashboard' %}",
            'business': "{% url 'business_dashboard' %}",
            'client': "{% url 'customer_dashboard' %}"
        };
        
        // Role-specific configurations
        const roleConfigs = {
            admin: {
                title: 'Admin Dashboard Login',
                subtitle: 'Access system administration and platform management',
                buttonText: 'Sign In to Admin Dashboard',
                icon: 'fas fa-crown',
                placeholder: 'Enter admin username',
                labelIcon: 'fas fa-user-shield',
                dashboardName: 'Admin Dashboard'
            },
            business: {
                title: 'Business Dashboard Login',
                subtitle: 'Manage your organization, payments, and analytics',
                buttonText: 'Sign In to Business Dashboard',
                icon: 'fas fa-building',
                placeholder: 'Enter business email or username',
                labelIcon: 'fas fa-user-tie',
                dashboardName: 'Business Dashboard'
            },
            client: {
                title: 'Client Portal Login',
                subtitle: 'View invoices, make payments, and track transactions',
                buttonText: 'Sign In to Customer Dashboard',
                icon: 'fas fa-user-circle',
                placeholder: 'Enter your email address',
                labelIcon: 'fas fa-user',
                dashboardName: 'Customer Dashboard'
            }
        };
        
        // Role selection
        roleTabs.forEach(tab => {
            tab.addEventListener('click', function() {
                // Remove active class from all tabs
                roleTabs.forEach(t => t.classList.remove('active'));
                
                // Add active class to clicked tab
                this.classList.add('active');
                
                // Update selected role
                selectedRole = this.dataset.role;
                selectedRoleInput.value = selectedRole;
                nextUrlInput.value = dashboardUrls[selectedRole];
                
                // Update role hints
                roleHints.forEach(hint => hint.classList.remove('active'));
                document.getElementById(`${selectedRole}Hint`).classList.add('active');
                
                // Update dashboard previews
                dashboardPreviews.forEach(preview => preview.classList.remove('active'));
                document.getElementById(`${selectedRole}Preview`).classList.add('active');
                
                // Update form based on role
                const config = roleConfigs[selectedRole];
                loginTitle.textContent = config.title;
                loginSubtitle.textContent = config.subtitle;
                
                // Update button
                const buttonIcon = loginButton.querySelector('i');
                buttonIcon.className = config.icon;
                loginButton.innerHTML = `<i class="${config.icon}"></i> ${config.buttonText}`;
                
                // Update input placeholder and label
                usernameInput.placeholder = config.placeholder;
                
                // Update label icon
                const labelIcon = document.querySelector('.form-group-enhanced label i');
                if (labelIcon) {
                    labelIcon.className = config.labelIcon;
                }
            });
        });
        
        // Password toggle
        const togglePassword = document.getElementById('togglePassword');
        const passwordInput = document.getElementById('password');
        
        togglePassword.addEventListener('click', function() {
            const icon = this.querySelector('i');
            if (passwordInput.type === 'password') {
                passwordInput.type = 'text';
                icon.classList.remove('fa-eye');
                icon.classList.add('fa-eye-slash');
            } else {
                passwordInput.type = 'password';
                icon.classList.remove('fa-eye-slash');
                icon.classList.add('fa-eye');
            }
        });
        
        // Form submission with role-based redirect
        const loginForm = document.getElementById('loginForm');
        
        loginForm.addEventListener('submit', function(e) {
            // Prevent default form submission for demo
            e.preventDefault();
            
            // Get form data
            const username = usernameInput.value.trim();
            const password = passwordInput.value;
            
            // Basic validation
            if (!username || !password) {
                showError('Please fill in all required fields');
                return;
            }
            
            // Show redirect notification
            const redirectNotification = document.getElementById('redirectNotification');
            const redirectDashboard = document.getElementById('redirectDashboard');
            redirectDashboard.textContent = roleConfigs[selectedRole].dashboardName;
            redirectNotification.style.display = 'block';
            
            // Show loading state on button
            const button = loginButton;
            const originalText = button.innerHTML;
            button.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Authenticating...';
            button.disabled = true;
            
            // Simulate authentication delay
            setTimeout(() => {
                // In a real app, this would be your Django authentication
                // For demo purposes, we'll simulate successful login
                
                // Hide notification
                redirectNotification.style.display = 'none';
                
                // Reset button
                button.innerHTML = originalText;
                button.disabled = false;
                
                // Redirect to appropriate dashboard
                const redirectUrl = dashboardUrls[selectedRole];
                
                // Show success message before redirect
                showSuccess(`Login successful! Redirecting to ${roleConfigs[selectedRole].dashboardName}...`);
                
                // Redirect after 1.5 seconds
                setTimeout(() => {
                    // In real app, remove the alert and use actual redirect
                    // For now, we'll show an alert
                    alert(`SUCCESS! Would redirect to: ${redirectUrl}\n\nAdmin → admin_dashboard.html\nBusiness → business_dashboard.html\nClient → customer_dashboard.html`);
                    
                    // Uncomment for actual redirect:
                    // window.location.href = redirectUrl;
                }, 1500);
                
            }, 2000);
        });
        
        // Social login functions
        window.socialLogin = function(provider) {
            const config = roleConfigs[selectedRole];
            alert(`This would initiate ${provider} OAuth login for ${config.dashboardName}.`);
        };
        
        window.ssoLogin = function() {
            if (selectedRole === 'admin' || selectedRole === 'business') {
                alert(`Initiating Enterprise SSO for ${roleConfigs[selectedRole].dashboardName}...`);
            } else {
                alert('Enterprise SSO is only available for Admin and Business accounts.');
            }
        };
        
        // Auto-fill demo credentials
        window.autoFillCredentials = function() {
            const demoCredentials = {
                admin: {
                    username: 'admin@pesaflow.co.ke',
                    password: 'Admin@2024'
                },
                business: {
                    username: 'business@example.com',
                    password: 'Business@2024'
                },
                client: {
                    username: 'client@example.com',
                    password: 'Client@2024'
                }
            };
            
            const creds = demoCredentials[selectedRole];
            usernameInput.value = creds.username;
            passwordInput.value = creds.password;
            
            // Show success message
            showSuccess(`Demo credentials for ${roleConfigs[selectedRole].dashboardName} have been filled.`);
            
            // Close modal
            const modal = bootstrap.Modal.getInstance(document.getElementById('demoModal'));
            modal.hide();
        };
        
        // Show error function
        function showError(message) {
            const alertDiv = document.querySelector('.alert-role');
            if (alertDiv) {
                alertDiv.style.display = 'block';
                alertDiv.innerHTML = `<i class="fas fa-exclamation-circle me-2"></i> ${message}`;
                alertDiv.className = 'alert alert-danger alert-role';
                
                // Auto-hide after 5 seconds
                setTimeout(() => {
                    alertDiv.style.display = 'none';
                }, 5000);
            }
        }
        
        // Show success function
        function showSuccess(message) {
            const alertDiv = document.querySelector('.alert-role');
            if (alertDiv) {
                alertDiv.style.display = 'block';
                alertDiv.innerHTML = `<i class="fas fa-check-circle me-2"></i> ${message}`;
                alertDiv.className = 'alert alert-success alert-role';
                
                // Auto-hide after 3 seconds
                setTimeout(() => {
                    alertDiv.style.display = 'none';
                }, 3000);
            }
        }
        
        // Auto-detect role based on URL parameter
        const urlParams = new URLSearchParams(window.location.search);
        const roleParam = urlParams.get('role');
        if (roleParam && roleConfigs[roleParam]) {
            // Find and click the corresponding role tab
            const roleTab = document.querySelector(`.role-tab[data-role="${roleParam}"]`);
            if (roleTab) {
                roleTab.click();
            }
        }
        
        // Also check for 'next' parameter to determine role
        const nextParam = urlParams.get('next');
        if (nextParam) {
            if (nextParam.includes('admin')) {
                document.querySelector('.role-tab[data-role="admin"]').click();
            } else if (nextParam.includes('business')) {
                document.querySelector('.role-tab[data-role="business"]').click();
            } else if (nextParam.includes('customer')) {
                document.querySelector('.role-tab[data-role="client"]').click();
            }
        }
        
        // Add animation to form on load
        const loginFormEl = document.querySelector('.login-form');
        loginFormEl.style.animation = 'fadeIn 0.8s ease-out';
        
        // Auto-focus username field
        usernameInput.focus();
    });
</script>
{% endblock %}